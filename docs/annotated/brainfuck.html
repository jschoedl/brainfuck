<!DOCTYPE html>

<html>
<head>
  <title>brainfuck.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>brainfuck.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <blockquote>
<p>Brainfuck is an esoteric programming language created in 1993 by Urban
Müller, and notable for its extreme minimalism. The language consists of
only eight simple commands and an instruction pointer. While it is fully
Turing-complete, it is not intended for practical use…</p>
</blockquote>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <ul>
<li><a href="https://en.wikipedia.org/wiki/Brainfuck">https://en.wikipedia.org/wiki/Brainfuck</a></li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2 id="setup">setup</h2>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>some helper functions. need to know if we should use browser or node apis
for i/o. the following functions are read and write implementations for
specific environments. they include: a write function for node; a write
function for browsers; a read function for node; a read function for
browsers; a generic read function. use this in the interpreter; and a
generic write function. use this in the interpreter.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">
'use strict'</span>

<span class="hljs-keyword">const</span> inBrowser = <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span> !== <span class="hljs-string">'undefined'</span>
<span class="hljs-keyword">const</span> inputPrompt = <span class="hljs-string">'input: '</span>

<span class="hljs-keyword">const</span> nodeWrite = <span class="hljs-function">(<span class="hljs-params">str</span>) =&gt;</span>
  process.stdout.write(str)

<span class="hljs-keyword">const</span> browserWrite = <span class="hljs-function">(<span class="hljs-params">str</span>) =&gt;</span>
  <span class="hljs-built_in">console</span>.log(str)

<span class="hljs-keyword">const</span> nodeRead = <span class="hljs-function">(<span class="hljs-params">cb</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> readline = <span class="hljs-built_in">require</span>(<span class="hljs-string">'readline'</span>)

  <span class="hljs-keyword">const</span> rl = readline.createInterface({
    <span class="hljs-attr">input</span>: process.stdin,
    <span class="hljs-attr">output</span>: process.stdout
  })

  rl.question(inputPrompt, (input) =&gt; {
    rl.close()
    cb(input)
  })
}

<span class="hljs-keyword">const</span> browserRead = <span class="hljs-function">(<span class="hljs-params">cb</span>) =&gt;</span>
  cb(<span class="hljs-built_in">window</span>.prompt(inputPrompt) || <span class="hljs-built_in">String</span>.fromCharCode(<span class="hljs-number">0</span>))

<span class="hljs-keyword">const</span> read = <span class="hljs-function">(<span class="hljs-params">cb</span>) =&gt;</span>
  inBrowser ? browserRead(cb) : nodeRead(cb)

<span class="hljs-keyword">const</span> write = <span class="hljs-function">(<span class="hljs-params">str</span>) =&gt;</span>
  inBrowser ? browserWrite(str) : nodeWrite(str)

<span class="hljs-keyword">const</span> isset = <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span>
  val !== <span class="hljs-literal">null</span> &amp;&amp; val !== <span class="hljs-literal">undefined</span>

<span class="hljs-keyword">const</span> call = <span class="hljs-function">(<span class="hljs-params">fn</span>) =&gt;</span>
  fn()

<span class="hljs-keyword">const</span> pass = <span class="hljs-function">(<span class="hljs-params">x</span>) =&gt;</span>
  x</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h2 id="the-interpreter">the interpreter</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> exec = <span class="hljs-function">(<span class="hljs-params">prog, userHooks</span>) =&gt;</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>first, split the program into an array of characters so we can take action
upon each of them one by one. that is stores in <code>cmds</code>. then store the
number of “commands” so that we know when to stop and not have to check
the <code>.length</code> property over and over again. that is stores in <code>len</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">const</span> cmds = prog.split(<span class="hljs-string">''</span>)
  <span class="hljs-keyword">const</span> len = cmds.length</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>now to the state variables. first, two less important ones: <code>steps</code> is
used to track how many times the <code>dump</code> function has been called and <code>cmd</code>
is the local variable of the current command we are processing. this is a
local variable, so there is no need to pass it around to functions that
are in the state of the interpreter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> steps = <span class="hljs-number">0</span>
  <span class="hljs-keyword">var</span> cmd</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>the rest of the state variables: <code>jumps</code> is a stack of loop starting
indexes. see <code>[</code> and <code>]</code> operators.  <code>memory</code> is where we store the memory
cells of our program.  <code>pointer</code> this is where we are pointing to in
memory. always starts at zero.  finally, <code>ids</code> tracks the index of where
we are in the program</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> jumps = []
  <span class="hljs-keyword">var</span> memory = []
  <span class="hljs-keyword">var</span> pointer = <span class="hljs-number">0</span>
  <span class="hljs-keyword">var</span> idx = <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>some helper small functions. <code>curr</code> is used for getting the current value
in the memory cell we are pointing to. <code>save</code> is for setting the value of
the memory cell we are pointing to.  and <code>canDebug</code> and <code>dump</code> are for
debugging purposes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">const</span> curr = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span>
    memory[pointer] || <span class="hljs-number">0</span>

  <span class="hljs-keyword">const</span> save = <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> {
    memory[pointer] = val
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>do you want to see the state after every command?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">const</span> canDebug = <span class="hljs-function">(<span class="hljs-params">cmd</span>) =&gt;</span>
    !!process.env.DEBUG &amp;&amp; <span class="hljs-string">'-+&lt;&gt;[],.'</span>.indexOf(cmd) !== <span class="hljs-number">-1</span>

  <span class="hljs-keyword">const</span> dump = <span class="hljs-function">(<span class="hljs-params">cmd</span>) =&gt;</span>
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'[%s:%s]\t\tcmd: %s\t\tcurr: %s[%s]\t\tmem: %s'</span>, steps, idx, cmd,
      pointer, curr(), <span class="hljs-built_in">JSON</span>.stringify(memory))</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>finds the matching closing bracket of the start of a loop. see <code>[</code> and <code>]</code>
operators. increment for every <code>[</code> and decrement for every <code>]</code>. we’ll know
we’re at our closing bracket when we get to zero</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">const</span> findEnd = <span class="hljs-function">(<span class="hljs-params">idx</span>) =&gt;</span> {
    <span class="hljs-keyword">var</span> stack = <span class="hljs-number">1</span>

    <span class="hljs-keyword">while</span> (cmds[idx]) {
      <span class="hljs-keyword">switch</span> (cmds[idx]) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'['</span>:
          stack++
          <span class="hljs-keyword">break</span>

        <span class="hljs-keyword">case</span> <span class="hljs-string">']'</span>:
          stack--
          <span class="hljs-keyword">break</span>
      }

      <span class="hljs-keyword">if</span> (!stack) {
        <span class="hljs-keyword">break</span>
      } <span class="hljs-keyword">else</span> {
        idx++
      }
    }

    <span class="hljs-keyword">return</span> idx
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h3 id="hooks">hooks</h3>

            </div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>hooks allow other programs to interact with the internals of the
interpreter. they allow for custom io functions as well as ways to move on
to the next step and update state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">const</span> internalUpdate = <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
    memory = isset(state.memory) ? state.memory : memory
    pointer = isset(state.pointer) ? state.pointer : pointer
    idx = isset(state.idx) ? state.idx : idx
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>moves on to the next command. checks that we still have commands left to
read and also show debugging information. in a <code>process.nextTick</code> (or one
of its siblings) to prevent call stack overflows</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">const</span> internalTick = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (canDebug(cmd)) {
      dump(cmd)
    }

    steps++
    idx++

    <span class="hljs-keyword">if</span> (idx &lt; len &amp;&amp; <span class="hljs-keyword">typeof</span> cmds[idx] === <span class="hljs-string">'string'</span>) {
      process.nextTick(run, <span class="hljs-number">0</span>)
    } <span class="hljs-keyword">else</span> {
      hooks.done()
    }
  }

  <span class="hljs-keyword">const</span> tick = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span>
    hooks.tick(internalTick, internalUpdate, {
      pointer,
      idx,
      steps,
      <span class="hljs-attr">memory</span>: memory.slice(<span class="hljs-number">0</span>) })

  <span class="hljs-keyword">const</span> hooks = <span class="hljs-built_in">Object</span>.assign({ read, write, <span class="hljs-attr">tick</span>: call, <span class="hljs-attr">done</span>: pass },
    userHooks)</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h3 id="operators">operators</h3>
<table>
<thead>
<tr>
<th style="text-align:center">tok</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>&gt;</code></td>
<td>increment the data pointer (to point to the next cell to the right).</td>
</tr>
<tr>
<td style="text-align:center"><code>&lt;</code></td>
<td>decrement the data pointer (to point to the next cell to the left).</td>
</tr>
<tr>
<td style="text-align:center"><code>+</code></td>
<td>increment (increase by one) the byte at the data pointer.</td>
</tr>
<tr>
<td style="text-align:center"><code>-</code></td>
<td>decrement (decrease by one) the byte at the data pointer.</td>
</tr>
<tr>
<td style="text-align:center"><code>.</code></td>
<td>output the byte at the data pointer.</td>
</tr>
<tr>
<td style="text-align:center"><code>,</code></td>
<td>accept one byte of input, storing its value in the byte at the data pointer.</td>
</tr>
<tr>
<td style="text-align:center"><code>[</code></td>
<td>if the byte at the data pointer is zero, then instead of moving the instruction pointer forward to the next command, jump it forward to the command after the matching <code>]</code> command.</td>
</tr>
<tr>
<td style="text-align:center"><code>]</code></td>
<td>if the byte at the data pointer is nonzero, then instead of moving the instruction pointer forward to the next command, jump it back to the command after the matching <code>[</code> command.</td>
</tr>
</tbody>
</table>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">const</span> ops = {
    <span class="hljs-string">'+'</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> save((curr() === <span class="hljs-number">255</span> ? <span class="hljs-number">0</span> : curr() + <span class="hljs-number">1</span>)),
    <span class="hljs-string">'-'</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> save((curr() || <span class="hljs-number">256</span>) - <span class="hljs-number">1</span>),
    <span class="hljs-string">'&lt;'</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> --pointer,
    <span class="hljs-string">'&gt;'</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> ++pointer,
    <span class="hljs-string">'.'</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> hooks.write(<span class="hljs-built_in">String</span>.fromCharCode(curr())),

    <span class="hljs-string">'['</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (curr() === <span class="hljs-number">0</span>) {
        idx = findEnd(idx + <span class="hljs-number">1</span>)
      } <span class="hljs-keyword">else</span> {
        jumps.push(idx)
      }
    },

    <span class="hljs-string">']'</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (curr() !== <span class="hljs-number">0</span>) {
        idx = jumps[jumps.length - <span class="hljs-number">1</span>]
      } <span class="hljs-keyword">else</span> {
        jumps.pop()
      }
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>this is what executes every command</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">const</span> run = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    cmd = cmds[idx]

    <span class="hljs-keyword">if</span> (cmd <span class="hljs-keyword">in</span> ops) {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>is the current command a standard operator? if so just run it.
standard operators update the state themselvels</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      ops[cmd]()
      tick()
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cmd === <span class="hljs-string">','</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>since read functions may not always be blocking, we handle ‘,’ as a
special operator, separately from the flow of the rest of the
operators</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      hooks.read(<span class="hljs-function">(<span class="hljs-params">input</span>) =&gt;</span> {
        save(input.charCodeAt(<span class="hljs-number">0</span>))
        tick()
      })
    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>not a brainfuck command - ignore it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tick()
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>run this fucker</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  run()
}</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>the next two blocks of code declare a js template literal function and the
other checks if we are being ran as a stand-alone module and if we have an
argument being passed in - if this is the case run that brainfuck program
right away</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> brainfuck = <span class="hljs-function">(<span class="hljs-params">[prog]</span>) =&gt;</span>
  exec(prog)

<span class="hljs-keyword">if</span> (!<span class="hljs-built_in">module</span>.parent &amp;&amp; process.argv[<span class="hljs-number">2</span>]) {
  exec(<span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>).readFileSync(process.argv[<span class="hljs-number">2</span>]).toString())
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (inBrowser) {
  <span class="hljs-built_in">module</span>.exports = exec
} <span class="hljs-keyword">else</span> {
  <span class="hljs-built_in">module</span>.exports = { exec, brainfuck }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <pre><code class="lang-javascript"><span class="hljs-comment">// in js land</span>
brainfuck<span class="hljs-string">`-[-------&gt;+&lt;]
          &gt;-.-[-&gt;+++++&lt;]
          &gt;++.+++++++..+++.[---&gt;+&lt;]
          &gt;-----.--[-&gt;++++&lt;]
          &gt;-.--------.+++.------.--------.`</span>
</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <pre><code class="lang-bash"><span class="hljs-comment"># in your terminal</span>
$ node brainfuck.js src/bf/squares.bf
</code></pre>

            </div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
